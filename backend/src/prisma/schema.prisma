generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Product {
  id                   Int      @id @default(autoincrement())
  title                String
  description          String?
  category             String?
  price                Float
  discountPercentage   Float?
  rating               Float?
  stock                Int?
  brand                String?
  sku                  String?  @db.VarChar(100)
  weight               Float?
  dimensions           String?
  warrantyInformation  String?
  shippingInformation  String?
  availabilityStatus   String?
  returnPolicy         String?
  minimumOrderQuantity Int?
  meta                 Json?
  thumbnail            String?
  // images                 String[]  @db.Text[]        
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
  // tags                   Tag[]     @relation("ProductTags", references: [id])
  reviews Review[]
}

model Tag {
  id   Int    @id @default(autoincrement())
  name String @unique
  // products  Product[] @relation("ProductTags")
}

model Review {
  id            Int      @id @default(autoincrement())
  rating        Int
  comment       String
  date          DateTime @default(now())
  reviewerName  String?
  reviewerEmail String?
  product       Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId     Int
}

model User {
  id              String         @id @default(uuid())
  email           String         @unique
  passwordHash    String
  name            String?
  isEmailVerified Boolean        @default(false)
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  roles           UserRole[]
  refreshTokens   RefreshToken[]
}

model Role {
  id    String     @id @default(uuid())
  name  String     @unique
  users UserRole[]
}

model UserRole {
  id     String @id @default(uuid())
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId String
  role   Role   @relation(fields: [roleId], references: [id], onDelete: Cascade)
  roleId String

  @@unique([userId, roleId])
}

model RefreshToken {
  id           String   @id @default(uuid())
  tokenHash    String   @unique
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId       String
  revoked      Boolean  @default(false)
  createdAt    DateTime @default(now())
  expiresAt    DateTime
  replacedById String?
}
